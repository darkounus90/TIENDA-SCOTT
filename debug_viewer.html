<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>DEBUG 3D VIEWER</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            background: #0f172a;
            height: 100%;
            color: white;
            font-family: sans-serif;
        }

        #bike-viewer {
            width: 100%;
            height: 100%;
            position: relative;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            overflow: hidden;
        }

        .viewer-overlay-static {
            position: absolute;
            top: 20%;
            left: 10%;
            pointer-events: none;
            z-index: 10;
        }

        .viewer-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }

        .viewer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
        }

        .viewer-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: monospace;
            font-size: 1.2rem;
            pointer-events: none;
        }

        .hotspot {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.9);
            border: 2px solid white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hotspot::after {
            content: '+';
            color: white;
            font-weight: bold;
        }

        #debug-log {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.8);
            color: lime;
            font-family: monospace;
            padding: 10px;
            overflow-y: auto;
            z-index: 9999;
            border-top: 1px solid #333;
        }
    </style>

    <!-- MAPA DE IMPORTACI√ìN PARA JS DELIVR -->
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
      }
    }
  </script>
</head>

<body>

    <section id="bike-viewer">
        <div class="viewer-overlay-static">
            <h1>DEBUG MODE <span style="font-weight:300; opacity:0.7">| Scott 920</span></h1>
            <p>Si ves esto, el HTML carg√≥. Esperando JS...</p>
        </div>
        <div id="debug-log">Log Console:<br></div>
    </section>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Logger
        function log(msg) {
            const box = document.getElementById('debug-log');
            box.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
            box.scrollTop = box.scrollHeight;
            console.log(msg);
        }

        log("üöÄ Script iniciado.");

        const mountId = 'bike-viewer';
        const container = document.getElementById(mountId);

        if (!container) {
            log("‚ùå ERROR CR√çTICO: No existe el contenedor #bike-viewer");
        } else {
            log("‚úÖ Contenedor encontrado. Iniciando Three.js...");

            try {
                // Scene Setup
                const scene = new THREE.Scene();
                // Fondo degradado simple
                scene.background = new THREE.Color(0x1e293b);

                const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 100);
                camera.position.set(2, 1, 3);

                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                container.appendChild(renderer.domElement);
                log("‚úÖ Renderer a√±adido al DOM.");

                const controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;

                // Luces
                const ambientLight = new THREE.AmbientLight(0xffffff, 2.5);
                scene.add(ambientLight);
                const dirLight = new THREE.DirectionalLight(0xffffff, 2);
                dirLight.position.set(5, 10, 7);
                scene.add(dirLight);

                // Placeholder Bike
                log("üõ† Creando Bici Procedural...");
                const group = new THREE.Group();

                // Materiales
                const frameMat = new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 0.8, roughness: 0.2 });
                const tireMat = new THREE.MeshStandardMaterial({ color: 0x050505, roughness: 0.9 });

                // Cuadro simplificado
                const tubeGeo = new THREE.CylinderGeometry(0.04, 0.04, 1.2, 16);
                const topTube = new THREE.Mesh(tubeGeo, frameMat);
                topTube.rotation.z = Math.PI / 2;
                topTube.position.y = 0.8;
                group.add(topTube);

                // Ruedas
                const wheelGeo = new THREE.TorusGeometry(0.55, 0.05, 16, 50);
                const wheel1 = new THREE.Mesh(wheelGeo, tireMat);
                wheel1.position.set(-0.9, 0.55, 0);
                group.add(wheel1);

                const wheel2 = new THREE.Mesh(wheelGeo, tireMat);
                wheel2.position.set(0.9, 0.55, 0);
                group.add(wheel2);

                scene.add(group);
                log("‚úÖ Escena construida.");

                // UI Controls
                const uiControls = document.createElement('div');
                uiControls.className = 'viewer-controls';
                uiControls.innerHTML = `<button class="viewer-btn" id="rotateBtn">Auto-Rotaci√≥n: ON</button>`;
                container.appendChild(uiControls);

                let autoRotate = true;
                document.getElementById('rotateBtn').onclick = () => {
                    autoRotate = !autoRotate;
                    controls.autoRotate = autoRotate;
                    document.getElementById('rotateBtn').textContent = `Auto-Rotaci√≥n: ${autoRotate ? 'ON' : 'OFF'}`;
                };

                // Render Loop
                function animate() {
                    requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                }
                animate();
                log("‚úÖ Ciclo de animaci√≥n iniciado. DEBER√çAS VER LA BICI.");

                // Resize
                window.addEventListener('resize', () => {
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeight);
                });

            } catch (err) {
                log("‚ùå ERROR FATAL en JS: " + err.message + "\n" + err.stack);
            }
        }
    </script>
</body>

</html>